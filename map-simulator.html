<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASTRA HQ - Terminal de Controlo de Miss√£o</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes pulse-sos {
            0%, 100% { transform: scale(1.5); box-shadow: 0 0 0 0 rgba(255, 82, 82, 0.7); }
            50% { transform: scale(1.7); box-shadow: 0 0 0 10px rgba(255, 82, 82, 0); }
        }
        .animate-pulse-sos { animation: pulse-sos 1.5s infinite; }
        .map-layer { transition: opacity 0.3s ease-in-out; pointer-events: none; }
        .map-bg { background-color: #1a3a1a; /* Verde escuro para a terra */ }
        .map-river { position: absolute; background-color: #2a5298; /* Azul para o rio */ }
        .map-city { position: absolute; background-color: #4a5568; /* Cinza para cidade */ }
        .map-community { position: absolute; background-color: #795548; /* Marrom para comunidade */ width: 10px; height: 10px; border-radius: 50%; }
        .map-port i { text-shadow: 0px 0px 4px rgba(0, 0, 0, 0.7); }
        .vessel { transition: top 0.1s linear, left 0.1s linear; }
        .vessel-balsa { background-color: #f97316; } /* Laranja */
        .vessel-lancha { background-color: #facc15; } /* Amarelo */
        .vessel-recreio { background-color: #e5e7eb; } /* Branco */
    </style>
</head>
<body class="bg-gray-900 text-gray-200 font-mono flex h-screen overflow-hidden">

    <!-- Coluna do Mapa (Esquerda) -->
    <div class="w-2/3 h-full p-2">
        <div id="map-container" class="relative w-full h-full rounded-lg overflow-hidden border-2 border-gray-700 map-bg">
            <!-- Elementos Est√°ticos do Mapa (Rios, Cidades) -->
            <div id="static-map-elements">
                <div class="map-river" style="top: 40%; left: 0; width: 100%; height: 25%;"></div> <!-- Rio Principal -->
                <div class="map-river" style="top: 0; left: 58%; width: 15%; height: 40%;"></div> <!-- Afluente Norte -->
                <div class="map-city" style="top: 45%; left: 55%; width: 12%; height: 10%; border-radius: 10px;"></div>
            </div>
            
            <!-- Elementos Din√¢micos (Portos, Comunidades, Embarca√ß√µes) -->
            <div id="dynamic-map-elements"></div>

            <!-- Camadas de Dados -->
            <div id="weather-layer" class="map-layer absolute top-1/2 left-1/2 w-[300px] h-[250px] rounded-full hidden opacity-70 transform -translate-x-1/2 -translate-y-1/2" style="background: radial-gradient(circle, rgba(255,255,0,0.4), rgba(0,100,255,0.1));"></div>
            <div id="hotspots-layer" class="map-layer hidden">
                <div class="absolute text-2xl" style="top: 25%; left: 50%;"><i class="fas fa-fire text-red-500"></i></div>
                <div class="absolute text-2xl" style="top: 60%; left: 70%;"><i class="fas fa-fire text-red-500"></i></div>
            </div>

            <!-- Controles e Legenda -->
            <div class="absolute top-2 right-2 bg-gray-900 bg-opacity-80 p-3 rounded-lg border border-gray-700 text-sm space-y-3">
                <div>
                    <h3 class="font-bold mb-2 border-b border-gray-600 pb-1">Camadas de Dados</h3>
                    <label class="flex items-center space-x-2 cursor-pointer"><input type="checkbox" id="toggle-weather" class="form-checkbox bg-gray-700 text-orange-500"><span>Radar Clim√°tico</span></label>
                    <label class="flex items-center space-x-2 mt-1 cursor-pointer"><input type="checkbox" id="toggle-hotspots" class="form-checkbox bg-gray-700 text-orange-500"><span>Focos de Calor</span></label>
                </div>
                <div>
                    <h3 class="font-bold mb-2 border-b border-gray-600 pb-1">Legenda</h3>
                    <div class="flex items-center space-x-2"><div class="w-4 h-4 rounded-full vessel-balsa flex items-center justify-center"><i class="fas fa-truck-moving text-xs text-black"></i></div><span>Balsa de Carga</span></div>
                    <div class="flex items-center space-x-2 mt-1"><div class="w-4 h-4 rounded-full vessel-lancha flex items-center justify-center"><i class="fas fa-bolt text-xs text-black"></i></div><span>Lancha R√°pida</span></div>
                    <div class="flex items-center space-x-2 mt-1"><div class="w-4 h-4 rounded-full vessel-recreio flex items-center justify-center"><i class="fas fa-ship text-xs text-black"></i></div><span>Barco Regional</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Coluna de Dados (Direita) -->
    <div class="w-1/3 h-full flex flex-col p-2 space-y-2">
        <div id="telemetry-panel" class="bg-gray-800 p-4 rounded-lg border-2 border-gray-700 flex-grow basis-1/3 overflow-y-auto"></div>
        <div id="orbital-panel" class="bg-gray-800 p-4 rounded-lg border-2 border-gray-700 flex-grow basis-1/3 overflow-y-auto"></div>
        <div id="alerts-panel" class="bg-gray-800 p-4 rounded-lg border-2 border-gray-700 flex-grow basis-1/3 overflow-y-auto"></div>
    </div>

<script>
    // --- Refer√™ncias do DOM ---
    const dynamicMapElements = document.getElementById('dynamic-map-elements');
    const telemetryPanel = document.getElementById('telemetry-panel');
    const orbitalPanel = document.getElementById('orbital-panel');
    const alertsPanel = document.getElementById('alerts-panel');
    const toggleWeather = document.getElementById('toggle-weather');
    const toggleHotspots = document.getElementById('toggle-hotspots');
    const weatherLayer = document.getElementById('weather-layer');
    const hotspotsLayer = document.getElementById('hotspots-layer');

    // --- Defini√ß√£o das Rotas de Navega√ß√£o ---
    const path1 = [[10, 45], [20, 48], [30, 46], [40, 50], [55, 52], [70, 48], [85, 50], [95, 45]];
    const path2 = [[90, 58], [80, 55], [70, 58], [60, 60], [45, 58], [30, 60], [15, 55], [5, 58]];
    const path3 = [[62, 30], [60, 40], [58, 50], [63, 60], [65, 70]];

    // --- Dados do Ecossistema ---
    const embarcacoes = [
        { id: 1, nome: "Expresso Juru√°", type: 'balsa', icon: 'fa-truck-moving', path: path1, pathIndex: 0, top: 10, left: 45, bateria: 95, sinal: -85, velocidade: 12, sosActive: false, alertedLowBattery: false },
        { id: 2, nome: "Ligeirinho Ajato", type: 'lancha', icon: 'fa-bolt', path: path2, pathIndex: 0, top: 90, left: 58, bateria: 78, sinal: -92, velocidade: 15, sosActive: false, alertedLowBattery: false },
        { id: 3, nome: "Comunidade Unida", type: 'recreio', icon: 'fa-ship', path: path3, pathIndex: 0, top: 62, left: 30, bateria: 85, sinal: -101, velocidade: 9, sosActive: false, alertedLowBattery: false },
        { id: 4, nome: "Carga Pesada II", type: 'balsa', icon: 'fa-truck-moving', path: path1, pathIndex: 4, top: 55, left: 52, bateria: 25, sinal: -115, velocidade: 10, sosActive: false, alertedLowBattery: false },
    ];
    const portos = [ { nome: "Porto de Manaus", top: 51, left: 61 } ];
    const comunidades = [ { nome: "Vila do Lago", top: 30, left: 40 }, { nome: "Comunidade do Rio", top: 68, left: 25 } ];
    const nasaData = { temperaturaAgua: 28.5, precipitacao: 80.0, velocidadeVento: 15.2 };

    // --- Vari√°veis de Estado ---
    let selectedVesselId = null;
    let passSchedule = [];
    let alerts = [];

    // --- Fun√ß√µes dos Pain√©is ---
    function updateTelemetryPanel(vessel) {
        if (!vessel) {
            telemetryPanel.innerHTML = `<h2 class="text-lg font-bold border-b-2 border-orange-500 pb-1 mb-2"><i class="fas fa-satellite-dish text-orange-500"></i> Telemetria do Ativo</h2><div class="text-gray-400">Selecione uma embarca√ß√£o no mapa.</div>`;
            return;
        }
        telemetryPanel.innerHTML = `
            <h2 class="text-lg font-bold border-b-2 border-orange-500 pb-1 mb-2"><i class="fas fa-satellite-dish text-orange-500"></i> ${vessel.nome}</h2>
            <p><i class="fas fa-battery-full w-5 text-green-500"></i> Bateria: <span class="font-bold">${vessel.bateria.toFixed(1)}%</span></p>
            <p><i class="fas fa-signal w-5 text-blue-500"></i> Sinal GSM: <span class="font-bold">${vessel.sinal} dBm</span></p>
            <p><i class="fas fa-tachometer-alt w-5 text-yellow-500"></i> Velocidade: <span class="font-bold">${vessel.velocidade} n√≥s</span></p>
            <h4 class="font-bold mt-4 mb-2 text-gray-300">Dados NASA (Regi√£o):</h4>
            <p><i class="fas fa-thermometer-half w-5 text-red-500"></i> Temp. √Ågua: <span class="font-bold">${nasaData.temperaturaAgua}¬∞C</span></p>
            <p><i class="fas fa-cloud-rain w-5 text-cyan-500"></i> Precipita√ß√£o: <span class="font-bold">${nasaData.precipitacao} mm/h</span></p>
            <p><i class="fas fa-wind w-5 text-gray-400"></i> Vento: <span class="font-bold">${nasaData.velocidadeVento} km/h</span></p>
            <button onclick="activateSOS()" class="w-full mt-4 bg-red-600 hover:bg-red-500 text-white font-bold py-2 rounded-lg flex items-center justify-center">
                <i class="fas fa-life-ring mr-2"></i> ATIVAR S.O.S
            </button>`;
    }
    
    function generatePassSchedule() {
        passSchedule = [];
        const now = new Date();
        const satellites = ["TERRA", "AQUA", "ISS", "LANDSAT-8"];
        for (let i = 0; i < 4; i++) {
            const futureTime = new Date(now.getTime() + (i * 30 + Math.random() * 20) * 60000);
            passSchedule.push({
                satellite: satellites[Math.floor(Math.random() * satellites.length)],
                time: futureTime,
                duration: Math.floor(5 + Math.random() * 5)
            });
        }
    }

    function updateOrbitalPanel() {
        const now = new Date();
        const upcomingPasses = passSchedule.filter(p => p.time > now);

        if (upcomingPasses.length === 0) {
            orbitalPanel.innerHTML = `
                <h2 class="text-lg font-bold border-b-2 border-teal-500 pb-1 mb-2"><i class="fab fa-wpexplorer text-teal-500"></i> Visibilidade Orbital (NASA)</h2>
                <div class="text-gray-400">Aguardando c√°lculo de novas passagens...</div>`;
            generatePassSchedule();
            return;
        }

        const nextPass = upcomingPasses[0];
        const timeToNextPass = Math.floor((nextPass.time - now) / 1000);
        const minutes = Math.floor(timeToNextPass / 60);
        const seconds = timeToNextPass % 60;

        let passListHtml = upcomingPasses.slice(0, 4).map(p => `
            <div class="text-sm p-1 rounded ${p === nextPass ? 'bg-teal-500/20' : ''}">
                üõ∞Ô∏è ${p.satellite} @ ${p.time.toLocaleTimeString('pt-BR')} (${p.duration} min)
            </div>
        `).join('');

        orbitalPanel.innerHTML = `
            <h2 class="text-lg font-bold border-b-2 border-teal-500 pb-1 mb-2"><i class="fab fa-wpexplorer text-teal-500"></i> Visibilidade Orbital (NASA)</h2>
            <div>
                <p>Status Conex√£o: <span class="text-red-500 font-bold">N√ÉO VIS√çVEL</span></p>
                <p>Pr√≥xima Janela em: <span class="text-teal-400 font-bold">${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}</span></p>
            </div>
            <div class="mt-3">
                <h4 class="font-bold text-gray-300">Pr√≥ximas Passagens:</h4>
                <div class="space-y-1 mt-1">${passListHtml}</div>
            </div>
        `;
    }

    function updateAlertsPanel() {
        let content = alerts.map(alert => {
            let colorClass = 'text-gray-300', icon = 'fa-info-circle';
            if (alert.type === 'SOS') { colorClass = 'text-red-400 font-bold'; icon = 'fa-skull-crossbones'; }
            else if (alert.type === 'SISTEMA') { colorClass = 'text-yellow-400'; icon = 'fa-cogs'; }
            else if (alert.type === 'CLIMA') { colorClass = 'text-blue-400'; icon = 'fa-cloud-showers-heavy'; }
            return `<div class="${colorClass}"><i class="fas ${icon} mr-2"></i>[${alert.timestamp}] ${alert.message}</div>`;
        }).join('');
        alertsPanel.innerHTML = `<h2 class="text-lg font-bold border-b-2 border-red-500 pb-1 mb-2"><i class="fas fa-triangle-exclamation text-red-500"></i> Registro de Eventos</h2><div class="text-sm space-y-2">${alerts.length > 0 ? content : '<p class="text-gray-500">Nenhum evento registrado.</p>'}</div>`;
    }

    // --- Fun√ß√µes de L√≥gica ---
    function addAlert(type, message, vesselId = null) {
        const timestamp = new Date().toLocaleTimeString('pt-BR');
        alerts.unshift({ timestamp, type, message, vesselId });
        if (alerts.length > 20) alerts.pop();
        updateAlertsPanel();
    }

    function selectVessel(id) {
        selectedVesselId = id;
        const vessel = embarcacoes.find(e => e.id === id);
        updateTelemetryPanel(vessel);
    }

    function activateSOS() {
        if (!selectedVesselId) return;
        const vessel = embarcacoes.find(e => e.id === selectedVesselId);
        if (vessel && !vessel.sosActive) {
            vessel.sosActive = true;
            addAlert('SOS', `Sinal de SOS recebido da embarca√ß√£o ${vessel.nome}!`, vessel.id);
        }
    }

    // --- Fun√ß√µes de Renderiza√ß√£o do Mapa ---
    function renderDynamicMapElements() {
        let html = '';
        portos.forEach(p => html += `<div class="absolute text-2xl text-white map-port" style="top:${p.top}%; left:${p.left}%;"><i class="fas fa-anchor"></i><span class="text-xs absolute -bottom-4 left-1/2 -translate-x-1/2 whitespace-nowrap">${p.nome}</span></div>`);
        comunidades.forEach(c => html += `<div class="map-community" style="top:${c.top}%; left:${c.left}%;"></div>`);
        embarcacoes.forEach(emb => {
            let extraClasses = selectedVesselId === emb.id ? 'border-4 border-yellow-300' : '';
            if (emb.sosActive) extraClasses += ' animate-pulse-sos';
            html += `<div id="vessel-${emb.id}" class="absolute w-8 h-8 rounded-full flex items-center justify-center cursor-pointer transform -translate-x-1/2 -translate-y-1/2 vessel vessel-${emb.type} ${extraClasses}" style="top:${emb.top}%; left:${emb.left}%;" onclick="selectVessel(${emb.id})">
                        <i class="fas ${emb.icon} text-black"></i>
                     </div>`;
        });
        dynamicMapElements.innerHTML = html;
    }

    // --- L√≥gica de Movimento e Simula√ß√£o ---
    function updateVesselPositions() {
        embarcacoes.forEach(emb => {
            const target = emb.path[emb.pathIndex];
            const dx = target[0] - emb.left;
            const dy = target[1] - emb.top;
            const distance = Math.sqrt(dx * dx + dy * dy);
            if (distance < 1) {
                emb.pathIndex = (emb.pathIndex + 1) % emb.path.length;
            } else {
                const speed = 0.1 * (emb.type === 'lancha' ? 1.5 : 1); // Lancha mais r√°pida
                emb.left += (dx / distance) * speed;
                emb.top += (dy / distance) * speed;
            }
        });
    }

    // --- Loop Principal ---
    function gameLoop() {
        updateVesselPositions();
        embarcacoes.forEach(emb => {
            emb.bateria -= 0.005;
            if (emb.bateria < 30 && !emb.alertedLowBattery) {
                addAlert('SISTEMA', `Bateria baixa (${emb.bateria.toFixed(0)}%) na embarca√ß√£o ${emb.nome}.`, emb.id);
                emb.alertedLowBattery = true;
            }
        });
        if (selectedVesselId) {
            updateTelemetryPanel(embarcacoes.find(e => e.id === selectedVesselId));
        }
        renderDynamicMapElements();
    }
    
    // --- Inicializa√ß√£o ---
    toggleWeather.addEventListener('change', () => weatherLayer.classList.toggle('hidden', !toggleWeather.checked));
    toggleHotspots.addEventListener('change', () => hotspotsLayer.classList.toggle('hidden', !toggleHotspots.checked));
    
    updateTelemetryPanel(null);
    updateAlertsPanel();
    addAlert('SISTEMA', 'Terminal ASTRA HQ iniciado.');
    generatePassSchedule();
    renderDynamicMapElements();
    
    setInterval(gameLoop, 100);
    setInterval(updateOrbitalPanel, 1000);
</script>

</body>
</html>