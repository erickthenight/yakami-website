<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ASTRA-Net Platform | YAKAMI TECH</title>
  <meta name="description" content="Sistema de monitoramento e rastreamento por sat√©lite para a Amaz√¥nia - Tecnologia de √ìrbita Baixa (LEO)" />
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Leaflet (Mapa) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  
  <style>
    body { font-family: 'IBM Plex Mono', monospace; }
    .leaflet-container { background: #1e293b; } /* Fundo escuro para o mapa */
    .vessel-marker { 
      border-radius: 50%; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      font-size: 10px;
      color: black;
      transition: all 0.3s ease;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    .vessel-balsa { background-color: #f97316; }
    .vessel-lancha { background-color: #facc15; }
    .vessel-recreio { background-color: #e5e7eb; }
    .animate-pulse-sos {
      animation: pulse-sos 1.5s infinite;
    }
    @keyframes pulse-sos {
      0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
      50% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
    }
    .port-marker i {
        text-shadow: 0 0 8px rgba(0, 100, 150, 0.8);
    }
    .port-marker-organizado i {
        text-shadow: 0 0 12px rgba(200, 150, 0, 0.9);
    }
    .panel-bg { background: #1e293b; border: 1px solid #334155; }
    .panel-title { border-bottom: 1px solid #334155; padding-bottom: 0.5rem; margin-bottom: 0.5rem; }
    .status-visible { color: #10b981; }
    .status-not-visible { color: #ef4444; }
    .passage-item { color: #0ea5e9; }
    .alert-item { color: #f59e0b; }
    .normal-level { color: #10b981; }
    .alert-level { color: #ef4444; }
  </style>
</head>
<body class="bg-gray-900 text-gray-200">

  <!-- Cabe√ßalho -->
  <header class="bg-white/10 backdrop-blur-sm border-b border-gray-800 py-4">
    <div class="container mx-auto px-4 flex items-center justify-between">
      <div class="flex items-center space-x-2">
        <i class="fas fa-satellite text-orange-500 text-xl"></i>
        <span class="font-bold text-lg">YAKAMI TECH</span>
      </div>
      <div class="text-sm bg-orange-500/20 text-orange-300 px-3 py-1 rounded-full">
        NASA Space Apps Challenge 2025
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 py-8">
    <!-- T√≠tulo -->
    <div class="text-center mb-10">
      <h1 class="text-3xl md:text-4xl font-bold mb-2">ASTRA-Net Platform</h1>
      <p class="text-gray-400 max-w-2xl mx-auto">
        Sistema de monitoramento e rastreamento por sat√©lite para a Amaz√¥nia - Tecnologia de √ìrbita Baixa (LEO)
      </p>
      <div class="mt-4 flex justify-center space-x-4">
        <a href="https://github.com/astranetam-dev/astra-net-platform" target="_blank" class="text-blue-400 hover:underline flex items-center">
          <i class="fab fa-github mr-1"></i> GitHub Repository
        </a>
        <button class="text-orange-500 font-medium">Ver funcionalidades</button>
      </div>
    </div>

    <!-- Se√ß√£o de Demonstra√ß√£o -->
    <div class="text-center mb-8">
      <h2 class="text-xl font-bold mb-2">DEMONSTRA√á√ÉO INTERATIVA</h2>
      <h3 class="text-lg text-gray-400 mb-2">Mapa de Monitoramento & Opera√ß√µes Fluviais da Amaz√¥nia</h3>
      <p class="text-gray-500">Explore servi√ßos e visualize camadas de dados da NASA em tempo real sobre a regi√£o Amaz√¥nica Brasileira.</p>
    </div>

    <!-- Layout Principal -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Mapa -->
      <div class="lg:col-span-2">
        <!-- Bot√µes S.O.S e Mensagem -->
        <div class="flex justify-end mb-2 space-x-2">
          <button class="bg-red-600 hover:bg-red-500 text-white px-4 py-2 rounded-lg flex items-center">
            <i class="fas fa-exclamation-triangle mr-1"></i> S.O.S
          </button>
          <button class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg flex items-center">
            <i class="fas fa-envelope mr-1"></i> Mensagem
          </button>
        </div>
        <div id="map" class="w-full h-[500px] rounded-xl border border-gray-700 shadow-lg"></div>
      </div>

      <!-- Pain√©is Laterais -->
      <div class="space-y-6">
        <!-- Visibilidade Orbital -->
        <div class="panel-bg p-4 rounded-lg">
          <h3 class="font-bold panel-title">Visibilidade Orbital</h3>
          <div class="space-y-2">
            <p><strong>Status:</strong> <span id="orbital-status" class="status-not-visible">N√ÉO VIS√çVEL</span></p>
            <p><strong>Pr√≥xima janela:</strong> <span id="next-window" class="text-cyan-400">09:02</span></p>
            <div>
              <strong>Pr√≥ximas Passagens:</strong>
              <div id="passages-list" class="mt-1 space-y-1">
                <div class="text-xs passage-item"><i class="fas fa-satellite mr-1"></i> YAKAMI-SAT-01 @ 00:57:56 (9 min)</div>
                <div class="text-xs passage-item"><i class="fas fa-satellite mr-1"></i> YAKAMI-SAT-01 @ 01:00:46 (5 min)</div>
                <div class="text-xs passage-item"><i class="fas fa-satellite mr-1"></i> AQUA (NASA) @ 01:18:33 (7 min)</div>
                <div class="text-xs passage-item"><i class="fas fa-satellite mr-1"></i> TERRA (NASA) @ 01:25:22 (5 min)</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Alertas e Dados Ambientais -->
        <div class="panel-bg p-4 rounded-lg">
          <h3 class="font-bold panel-title">Alertas e Dados Ambientais</h3>
          <div class="space-y-2">
            <div>
              <strong>N√≠veis dos Rios (Portos):</strong>
              <div id="river-levels" class="mt-1 space-y-1">
                <div class="text-xs flex justify-between"><span>Porto de Manaus</span><span class="normal-level">16.85m (Normal)</span></div>
                <div class="text-xs flex justify-between"><span>Porto Chibat√£o</span><span class="normal-level">15.30m (Normal)</span></div>
                <div class="text-xs flex justify-between"><span>TUP Moss</span><span class="normal-level">15.82m (Normal)</span></div>
                <div class="text-xs flex justify-between"><span>Super Terminais</span><span class="alert-level">22.84m (Alerta)</span></div>
                <div class="text-xs flex justify-between"><span>Porto Juarez Prates</span><span class="alert-level">23.35m (Alerta)</span></div>
              </div>
            </div>
            <div>
              <strong>Alertas de Sat√©lite (NASA):</strong>
              <div id="nasa-alerts" class="mt-1 space-y-1">
                <div class="text-xs alert-item"><i class="fas fa-exclamation-triangle mr-1"></i> [00:48:52] Risco de tempestade severa (GPM).</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Se√ß√£o: Monitoramento em Tempo Real -->
    <section class="mt-12">
      <div class="text-center mb-8">
        <h2 class="text-2xl font-bold">Monitoramento por Sat√©lite em Tempo Real</h2>
        <p class="text-gray-400 mt-2 max-w-3xl mx-auto">
          O ASTRA-Net utiliza tecnologia de sat√©lites LEO para fornecer dados precisos sobre condi√ß√µes fluviais, localiza√ß√£o e monitoramento ambiental na Amaz√¥nia, mesmo nas √°reas mais remotas.
        </p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-5 gap-4 text-center">
        <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 flex flex-col items-center justify-center">
          <i class="fas fa-sync-alt text-blue-400 text-2xl mb-2"></i>
          <p class="text-sm font-semibold">Dados Atualizados</p>
          <p class="text-xs text-gray-400">Sat√©lites LEO a cada 2h</p>
        </div>
        <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 flex flex-col items-center justify-center">
          <i class="fas fa-ship text-blue-400 text-2xl mb-2"></i>
          <p class="text-sm font-semibold">Rastreamento Preciso</p>
          <p class="text-xs text-gray-400">Em tempo real</p>
        </div>
        <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 flex flex-col items-center justify-center">
          <i class="fas fa-water text-blue-400 text-2xl mb-2"></i>
          <p class="text-sm font-semibold">Condi√ß√µes Fluviais</p>
          <p class="text-xs text-gray-400">N√≠vel e clima dos portos</p>
        </div>
        <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 flex flex-col items-center justify-center">
          <i class="fas fa-fire text-orange-500 text-2xl mb-2"></i>
          <p class="text-sm font-semibold">Alertas de Rota</p>
          <p class="text-xs text-gray-400">Queimadas e fuma√ßa</p>
        </div>
        <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 flex flex-col items-center justify-center">
          <i class="fas fa-users text-green-400 text-2xl mb-2"></i>
          <p class="text-sm font-semibold">Apoio a Comunidades</p>
          <p class="text-xs text-gray-400">Monitoramento ambiental</p>
        </div>
      </div>
    </section>

    <!-- Se√ß√£o: Tecnologia Espacial -->
    <section class="mt-10">
      <div class="text-center mb-6">
        <h2 class="text-2xl font-bold">TECNOLOGIA ESPACIAL</h2>
        <p class="text-gray-400">Funcionalidades da Plataforma</p>
        <p class="text-gray-500 mt-2">Desenvolvida com tecnologia de ponta para os desafios √∫nicos da Amaz√¥nia.</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="bg-gray-800 p-5 rounded-lg border border-gray-700">
          <i class="fas fa-satellite text-orange-500 text-2xl mb-3"></i>
          <h3 class="font-bold mb-2">Integra√ß√£o com Sat√©lites LEO</h3>
          <p class="text-sm text-gray-400">Conex√£o direta com sat√©lites de √≥rbita baixa para coleta de dados em tempo real.</p>
        </div>
        <div class="bg-gray-800 p-5 rounded-lg border border-gray-700">
          <i class="fas fa-ship text-blue-400 text-2xl mb-3"></i>
          <h3 class="font-bold mb-2">Rastreamento de Embarca√ß√µes</h3>
          <p class="text-sm text-gray-400">Monitoramento preciso da localiza√ß√£o, velocidade e rotas de embarca√ß√µes fluviais.</p>
        </div>
        <div class="bg-gray-800 p-5 rounded-lg border border-gray-700">
          <i class="fas fa-tree text-green-500 text-2xl mb-3"></i>
          <h3 class="font-bold mb-2">Vigil√¢ncia Ambiental</h3>
          <p class="text-sm text-gray-400">Detec√ß√£o de desmatamento, queimadas e mudan√ßas na cobertura vegetal.</p>
        </div>
      </div>
    </section>
  </main>

  <script>
    // --- INICIALIZA√á√ÉO DO MAPA ---
    const map = L.map('map').setView([-3.1190, -60.0217], 8);
    
    // Usando o mapa base do CARTO Light (mais limpo e profissional)
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
      subdomains: 'abcd',
      maxZoom: 18
    }).addTo(map);

    // --- CAMADAS DE DADOS (NASA E RIOS) ---
    const today = new Date().toISOString().split('T')[0];
    const nasaLayer = L.tileLayer(
      `https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/VIIRS_SNPP_Thermal_Anomalies_375m_Day/default/${today}/GoogleMapsCompatible_Level9/{z}/{y}/{x}.jpg`,
      { opacity: 0.7 }
    );

    // Desenha os rios da Amaz√¥nia (bbox expandida para cobrir mais √°rea)
    fetch('https://overpass-api.de/api/interpreter?data=[out:json];way["waterway"="river"](bbox:-10,-70,5,-2);out geom;')
      .then(r => r.json())
      .then(data => {
        data.elements.forEach(way => {
          if(way.geometry) {
            const coords = way.geometry.map(p => [p.lat, p.lon]);
            L.polyline(coords, { color: '#3b82f6', weight: 2, opacity: 0.8 }).addTo(map);
          }
        });
      });

    // --- DADOS DO ECOSSISTEMA (PORTOS COM COORDENADAS REAIS DA ANTAQ) ---
    const ports = [
      { nome: "Porto de Manaus (P. Organizado)", lat: -3.1067, lng: -60.0250, type: 'organizado' },
      { nome: "Porto Chibat√£o (TUP)", lat: -3.0900, lng: -60.0100, type: 'tup' },
      { nome: "TUP Moss", lat: -3.1150, lng: -60.0350, type: 'tup' },
      { nome: "Super Terminais (Itacoatiara)", lat: -2.8800, lng: -58.4500, type: 'tup' },
      { nome: "Porto Juarez Prates (Iranduba)", lat: -3.2720, lng: -60.2050, type: 'tup' }
    ];

    const vessels = [];
    const vesselMarkers = {};
    const totalVessels = 25;

    const riverLevels = {};
    ports.forEach(p => {
        riverLevels[p.nome] = { level: 15 + Math.random() * 10, status: 'Normal' };
    });

    let selectedVessel = null;
    let alerts = [];
    let passSchedule = [];

    // --- FUN√á√ïES DE GERA√á√ÉO E RENDERIZA√á√ÉO ---
    function generateFleet() {
        const types = ['balsa', 'lancha', 'recreio'];
        const centerPoints = [ 
          { lat: -3.1190, lng: -60.0217 }, // Rio Negro
          { lat: -3.4500, lng: -59.8000 }, // Rio Solim√µes
          { lat: -2.8000, lng: -60.2000 }  // Rio Negro (norte)
        ];
        for(let i=1; i<= totalVessels; i++) {
            const center = centerPoints[i % centerPoints.length];
            vessels.push({
                id: i, 
                nome: `YKM-${String(i).padStart(2, '0')}`,
                lat: center.lat + (Math.random() - 0.5) * 0.8, 
                lng: center.lng + (Math.random() - 0.5) * 0.8,
                type: types[i % types.length], 
                bateria: 70 + Math.random() * 30, 
                sinal: -90 + Math.random() * 20,
                velocidade: 8 + Math.random() * 10, 
                rpm: 1500 + Math.random() * 1000,
            });
        }
    }

    function renderPorts() {
        ports.forEach(p => {
            const iconClass = p.type === 'organizado' ? 'port-marker-organizado text-amber-500' : 'text-sky-500';
            const icon = L.divIcon({ 
              className: `port-marker ${iconClass} text-2xl`, 
              html: '<i class="fas fa-anchor"></i>', 
              iconSize: [24, 24],
              iconAnchor: [12, 24]
            });
            L.marker([p.lat, p.lng], { icon: icon })
              .addTo(map)
              .bindPopup(`<strong>${p.nome}</strong>`);
        });
    }

    function renderVessels() {
      vessels.forEach(v => {
        const el = L.divIcon({
          className: `vessel-marker vessel-${v.type} border-2 ${selectedVessel?.id === v.id ? 'border-blue-500 scale-125' : 'border-gray-400'} ${v.sosActive ? 'animate-pulse-sos' : ''}`,
          html: `<i class="fas fa-${v.type === 'balsa' ? 'truck-moving' : v.type === 'lancha' ? 'bolt' : 'ship'}"></i>`,
          iconSize: [24, 24],
          iconAnchor: [12, 12]
        });
        if (vesselMarkers[v.id]) {
            vesselMarkers[v.id].setLatLng([v.lat, v.lng]);
            vesselMarkers[v.id].setIcon(el);
        } else {
            const marker = L.marker([v.lat, v.lng], { icon: el })
              .addTo(map)
              .bindPopup(v.nome)
              .on('click', () => selectVessel(v));
            vesselMarkers[v.id] = marker;
        }
      });
    }

    // --- FUN√á√ïES DE L√ìGICA E INTERA√á√ÉO ---
    function selectVessel(v) {
      selectedVessel = v;
      updateTelemetryPanel(v);
    }

    function activateSOS() {
      if (!selectedVessel) return;
      selectedVessel.sosActive = true;
      addAlert('SOS', `Sinal de SOS recebido de ${selectedVessel.nome}!`);
      renderVessels();
    }
    
    // --- FUN√á√ïES DE SIMULA√á√ÉO ---
    function simulateMovement() {
        vessels.forEach(v => {
            v.lat += (Math.random() - 0.5) * 0.005;
            v.lng += (Math.random() - 0.5) * 0.005;
            v.velocidade += (Math.random() - 0.5) * 0.5;
            if(v.velocidade < 5) v.velocidade = 5; if(v.velocidade > 20) v.velocidade = 20;
            v.rpm += (Math.random() - 0.5) * 50;
            if(v.rpm < 1200) v.rpm = 1200; if(v.rpm > 2800) v.rpm = 2800;
        });
        renderVessels();
        if(selectedVessel) { updateTelemetryPanel(selectedVessel); }
    }

    function simulateRiverLevels() {
        for (const portName in riverLevels) {
            const data = riverLevels[portName];
            data.level += (Math.random() - 0.5) * 0.1;
            if (data.level < 10) data.level = 10; if (data.level > 29) data.level = 29;
            if (data.level > 25) data.status = 'Cheia'; else if (data.level > 20) data.status = 'Alerta'; else data.status = 'Normal';
        }
        updateAlertsPanel();
    }

    // --- FUN√á√ïES DE ATUALIZA√á√ÉO DOS PAIN√âIS ---
    function updateTelemetryPanel(v) {
      const panel = document.getElementById('telemetry-panel');
      if (!v) { 
        panel.innerHTML = `<h3 class="font-bold border-b border-orange-500 pb-1 mb-2 text-sm">Telemetria do Ativo</h3><p class="text-gray-500 text-sm">Selecione uma embarca√ß√£o.</p>`; 
        return; 
      }
      panel.innerHTML = `
        <h3 class="font-bold border-b border-orange-500 pb-1 mb-1 text-sm">${v.nome}</h3>
        <div class="grid grid-cols-2 gap-x-2 gap-y-1 text-sm mt-1">
          <p class="truncate flex items-center"><i class="fas fa-map-marker-alt fa-fw mr-1 text-red-400"></i> Lat: <strong>${v.lat.toFixed(4)}</strong></p>
          <p class="truncate flex items-center"><i class="fas fa-map-marker-alt fa-fw mr-1 text-red-400"></i> Lng: <strong>${v.lng.toFixed(4)}</strong></p>
          <p class="truncate flex items-center"><i class="fas fa-tachometer-alt fa-fw mr-1 text-yellow-500"></i> Vel.: <strong>${v.velocidade.toFixed(1)} n√≥s</strong></p>
          <p class="truncate flex items-center"><i class="fas fa-cogs fa-fw mr-1 text-gray-400"></i> RPM: <strong>${v.rpm.toFixed(0)}</strong></p>
          <p class="truncate flex items-center"><i class="fas fa-battery-full fa-fw mr-1 text-green-500"></i> Bat.: <strong>${v.bateria.toFixed(0)}%</strong></p>
          <p class="truncate flex items-center"><i class="fas fa-signal fa-fw mr-1 text-blue-500"></i> Sinal: <strong>${v.sinal.toFixed(0)} dBm</strong></p>
        </div>
        <div class="mt-2 grid grid-cols-2 gap-2 text-sm">
          <button onclick="activateSOS()" class="w-full bg-red-600 hover:bg-red-500 text-white py-1.5 rounded flex items-center justify-center">
            <i class="fas fa-life-ring mr-1"></i> S.O.S
          </button>
          <a href="#" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-1.5 rounded flex items-center justify-center" title="Enviar Mensagem">
            <i class="fas fa-envelope mr-1"></i> Mensagem
          </a>
        </div>`;
    }

    function addAlert(type, msg) {
      alerts.unshift({ type, msg, time: new Date().toLocaleTimeString() });
      if (alerts.length > 3) alerts.pop();
      updateAlertsPanel();
    }

    function updateAlertsPanel() {
        const panel = document.getElementById('alerts-panel');
        let riverLevelContent = Object.keys(riverLevels).map(portName => {
            const data = riverLevels[portName];
            let statusColor = 'text-green-400';
            if (data.status === 'Alerta') statusColor = 'text-yellow-400'; else if (data.status === 'Cheia') statusColor = 'text-red-400';
            return `<div class="text-xs flex justify-between"><span class="truncate pr-2">${portName.split('(')[0]}</span><span class="${statusColor} font-bold">${data.level.toFixed(2)}m (${data.status})</span></div>`;
        }).join('');
        const satelliteAlerts = `<div class="text-xs text-gray-300 mt-2"><i class="fas fa-exclamation-triangle text-yellow-400"></i> [${new Date().toLocaleTimeString()}] Risco de tempestade severa (GPM).</div>`;
        const sosAlerts = alerts.filter(a => a.type === 'SOS').map(a => `<div class="text-sm text-red-400 font-bold animate-pulse"><i class="fas fa-skull-crossbones"></i> [${a.time}] ${a.msg}</div>`).join('');
        panel.innerHTML = `
          <h3 class="font-bold border-b border-blue-400 pb-1 mb-2 text-sm">Alertas e Dados Ambientais</h3>
          ${sosAlerts}
          <div class="space-y-1">
            <h4 class="font-semibold text-xs text-gray-400 mt-1">N√≠veis dos Rios (Portos)</h4>
            ${riverLevelContent}
          </div>
          <div class="mt-2 pt-2 border-t border-gray-700">
            <h4 class="font-semibold text-xs text-gray-400">Alertas de Sat√©lite (NASA)</h4>
            ${satelliteAlerts}
          </div>`;
    }

    function updateOrbitalPanel() {
      const now = new Date();
      if (passSchedule.length === 0 || passSchedule[0].time < now) {
        const sats = ["YAKAMI-SAT-01", "Starlink-G7-5", "TERRA (NASA)", "AQUA (NASA)", "Sentinel-2 (ESA)"];
        passSchedule = [];
        for(let i=0; i < 4; i++){ 
          passSchedule.push({ 
            sat: sats[Math.floor(Math.random() * sats.length)], 
            time: new Date(now.getTime() + (i * 10 + Math.random() * 15) * 60000), 
            dur: 5 + Math.floor(Math.random() * 5) 
          }); 
        }
        passSchedule.sort((a,b) => a.time - b.time);
      }
      const next = passSchedule[0];
      const timeToPass = next.time - now;
      let statusText, statusColor, countdownText;
      if (timeToPass < 0 && timeToPass > -next.dur * 60 * 1000) {
          statusText = "VIS√çVEL"; statusColor = "text-green-400";
          const remainingTime = Math.floor((next.dur * 60 * 1000 + timeToPass) / 1000);
          const mm = String(Math.floor(remainingTime / 60)).padStart(2, '0');
          const ss = String(remainingTime % 60).padStart(2, '0');
          countdownText = `Fim da janela em: <span class="text-green-400 font-bold">${mm}:${ss}</span>`;
      } else {
          statusText = "N√ÉO VIS√çVEL"; statusColor = "text-red-500";
          const diff = Math.max(0, Math.floor(timeToPass / 1000));
          const mm = String(Math.floor(diff / 60)).padStart(2, '0');
          const ss = String(diff % 60).padStart(2, '0');
          countdownText = `Pr√≥xima janela: <span class="text-teal-400 font-bold">${mm}:${ss}</span>`;
      }
      const passList = passSchedule.map(p => `<div class="text-xs ${p.sat === next.sat ? 'text-teal-300' : ''}">üõ∞Ô∏è ${p.sat} @ ${p.time.toLocaleTimeString()} (${p.dur} min)</div>`).join('');
      document.getElementById('orbital-panel').innerHTML = `
        <h3 class="font-bold border-b border-teal-500 pb-1 mb-2 text-sm">Visibilidade Orbital</h3>
        <div class="text-sm space-y-1">
          <p>Status: <span class="${statusColor} font-bold">${statusText}</span></p>
          <p>${countdownText}</p>
          <div class="mt-2 pt-1 border-t border-gray-700">
            <h4 class="font-semibold mb-1">Pr√≥ximas Passagens:</h4>
            <div class="space-y-1">${passList}</div>
          </div>
        </div>`;
    }
  
    // --- INICIALIZA√á√ÉO ---
    generateFleet();
    renderPorts();
    renderVessels();
    updateTelemetryPanel(null);
    updateAlertsPanel();
    updateOrbitalPanel();
    addAlert('SISTEMA', 'Terminal de opera√ß√µes iniciado.');

    // Ativa/desativa camada da NASA com tecla 'N'
    document.addEventListener('keydown', (e) => {
      if (e.key === 'n' || e.key === 'N') {
        if (map.hasLayer(nasaLayer)) map.removeLayer(nasaLayer);
        else nasaLayer.addTo(map);
      }
    });

    setInterval(updateOrbitalPanel, 1000);
    setInterval(simulateMovement, 2000);
    setInterval(simulateRiverLevels, 5000);
  </script>
</body>
</html>